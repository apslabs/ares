<% content_for(:head) do %>
  <%= javascript_tag do %>
    function calcula_total(input){
      var total = parseFloat($F($(input).up('tr').select('input.para_calcula')[0])) * 	parseFloat($F($(input).up('tr').select('input.para_calcula')[1])) * 
(1 + (parseFloat($F($(input).up('tr').select('input.para_calcula')[2]))/100));

      $(input).up('tr').select('.calcula_total')[0].innerHTML=total;
    }
  <% end %>
<% end %>

	
  <%= f.inputs :name => "Detalle" do %>
  <table class="tabla">
    <thead>
    <tr>
       <th>Descripcion</th>
       <th>Cantidad</th>
       <th>Precio unitario</th>
       <th>% IVA</th>
       <th>Total por linea</th>
    </tr>
    </thead>
    <tbody>
    <%= f.semantic_fields_for :facturadetalle do |fd| %>
    <%= fd.semantic_errors %>
    <tr>
        <td><%= fd.input :descripcion, :label => false, :as => :text, :input_html => { :size => 10, :style => "text-align:left; width:400px; height:40px;"} %></td>

        <td><%= fd.input :cantidad, :label => false, :as => :numeric, :input_html => { :class => :para_calcula, :onblur => 'calcula_total(this);', :size => 10, :style => "text-align:right;"} %></td>
        
		<td><%= fd.input :preciounitario, :label => false, :as => :numeric,:input_html => {:onblur => 'calcula_total(this);', :class => :para_calcula, :size => 10, :style => "text-align:right;"} %></td>

		<td><%= fd.input :tasaiva, :label => false, :as => :numeric,:input_html => {:onblur => 'calcula_total(this);', :class => :para_calcula, :size => 10, :style => "text-align:right;"} %></td>

		<td><%= content_tag(:span, fd.object.totalitem, :class => 'calcula_total') %></td>

	    <td><%= link_to 'Borrar', fd.object , :confirm => 'Esta serguro?', :method => :delete %></td>
    </tr>
    <% end %>
<tr>
	<td><b>Importe total</b></td>
	<td></td>
	<td></td>
	<td></td>
	<td align="right"><b><%= number_to_currency(f.object.totalfactura) %></b></td>
	<td></td>
</tr>
    </tbody>
  </table>
 <% end %>
<% end %>
